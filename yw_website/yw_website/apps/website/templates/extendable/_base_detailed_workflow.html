{% extends 'extendable/__base_template.html' %}

{% block inherits_from_base_scripts %}
    {% load static %}
    {% get_static_prefix as STATIC_PREFIX %}
    <script src="{{ STATIC_PREFIX }}scripts/viz.js"></script>
    <script src="{{ STATIC_PREFIX }}scripts/d3.min.js"></script>
    <script src="{{ STATIC_PREFIX }}scripts/d3-graphviz.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_PREFIX }}design/detailed_design.css">

{% endblock %}

{% block main_content %}

<div class=box>
    <div class=edit_button>
        {% if edit == True %}
            <form method="get" action="{% url 'edit_page' workflow.id version.id %}">
                {% csrf_token %}
                <button type="submit"> Edit Workflow</button>
            </form>
            <div class=delete>
                <button onclick="deleteFunction()">Delete Workflow</button>
            </div>
            <script>
                function deleteFunction() {
                    if (confirm("Do you really want to delete this workflow?")) {
                        document.location.href="{% url 'delete_workflows' workflow.id %}";
                    }
                }
            </script>

</body>
</html>
        {% endif%}
    </div>
    <link rel="stylesheet" type="text/css" href="{% static 'design/detailed_design.css' %}">
    <div class=workflow_id>
        Workflow ID: {{ workflow.id }}
        <br>
        Author: {{workflow.user}}
    </div>


    <div class=title>
        {{ workflow.title}}
    </div>

    <ol id="elementStyle">
        <script type="text/javascript" src={% static "scripts/home_render_options.js" %}></script>
            <li>
                <div id="graph1" class = workflow-image></div>
            </li>
            <script type="text/javascript">
                graph = `{{ version.yw_graph_output|safe }}`
            </script>
            <script type="text/javascript" src={% static "scripts/graphviz_render.js" %}></script>
    </ol>

    {% if versions %}
        <div class="dropdown">
                <button class="dropbtn">
                    {% for version_ in versions %}
                        {% if version_.id == version.id %}
                            <text>Version #{{ forloop.counter }}  &#9662</text>
                            <br>
                        {% endif %}
                    {% endfor %}
                </button>
                <div class="dropdown-content">
                    {% for version_ in versions %}
                        {% if version_.id != version.id %}
                            <a href="{% url 'detailed_workflow' workflow.id version_.id %}">Version #{{ forloop.counter }}</a>
                        {%  endif %}
                    {% endfor %}
                </div>
            </div>
    {% endif %}


    <div class=outside_data>
        <b>Description: </b>{{workflow.description}}
        <br><br>
       <b>Tags: </b> 
        {% for tag in tags %}
            <span class=tags> {{tag}}{% if not forloop.last %},{% endif %} </span>
        {% endfor %} 
    </div>
    <hr />
    <div class=run-text>
        Runs associated with current version:
    </div>
    {% include 'includeable/run_list.html' with run_list=run_list %}
<div>

{% endblock %}
